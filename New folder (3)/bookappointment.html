<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Appointment</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="images/medicine.png">
  
  <!-- intl-tel-input CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css"/>
  
  <style>
    :root {
      --bg-color: #eef2f7;
      --primary-color: #007BFF;
      --primary-light: #52a5ff;
      --accent-red: #e74c3c;
      --text-color: #5b648c;
      --text-dark: #333950;
      --shadow-light: #ffffff;
      --shadow-dark: #d9e0e7;
      --border-radius: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.97); }
      to { opacity: 1; transform: scale(1); }
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
      color: var(--text-color);
    }
    
    .back-button {
      position: absolute;
      top: 30px;
      left: 30px;
      height: 50px;
      width: 50px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-color);
      color: var(--text-color);
      box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      z-index: 10;
    }

    .back-button:hover {
      color: var(--primary-color);
      box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
    }

    .back-button:active {
      box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
      color: var(--primary-light);
    }
    
    .container {
      width: 100%;
      max-width: 500px;
      background: var(--bg-color);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
      animation: fadeIn 0.6s ease-out forwards;
    }

    h2 {
      text-align: center;
      color: var(--text-dark);
      font-weight: 600;
      font-size: 1.8rem;
      margin-bottom: 35px;
    }

    .input-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    input {
      width: 100%;
      padding: 15px 20px;
      border-radius: var(--border-radius);
      border: none;
      background-color: var(--bg-color);
      box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
      color: var(--text-dark);
      transition: box-shadow 0.3s ease;
    }

    input:focus {
      outline: none;
      box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light), 0 0 0 2px var(--primary-color);
    }

    /* Styles for intl-tel-input library */
    .iti { width: 100%; }
    .iti input {
        padding-left: 58px !important; 
    }
    /* The search input inside the dropdown */
    .iti__search-input {
        width: 90% !important;
        margin: 5px auto !important;
        border-radius: 8px !important;
        border: 1px solid #ccc !important;
        padding: 8px 12px !important;
    }

    .button-group {
      display: flex;
      gap: 20px;
      margin-top: 30px;
    }

    .soft-button {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      background: var(--bg-color);
      color: var(--text-color);
      box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .soft-button:hover { color: var(--primary-color); }
    .soft-button:active {
      box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
      color: var(--primary-light);
    }
    
    .add-btn {
      color: white;
      background: var(--primary-color);
      box-shadow: 5px 5px 10px #0056b3, -5px -5px 10px var(--primary-light);
    }
    .add-btn:hover { background: var(--primary-light); color: white; }
    .add-btn:active {
      background: var(--primary-color);
      box-shadow: inset 5px 5px 10px #0056b3, inset -5px -5px 10px var(--primary-light);
    }

    .clear-btn { color: var(--accent-red); }
    .clear-btn:hover { color: #ff7668; }
    .clear-btn:active {
      color: #c9302c;
      box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
    }

    /* Loader Styles */
    .loader-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(238, 242, 247, 0.85);
      backdrop-filter: blur(5px);
      display: none; justify-content: center; align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    .loader-overlay.show { display: flex; opacity: 1; }
    .spinner {
      width: 60px; height: 60px;
      border: 6px solid var(--shadow-dark);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<!-- Loader Element -->
<div id="loader" class="loader-overlay">
  <div class="spinner"></div>
</div>

<a href="dashboard.html" class="back-button" title="Go to Dashboard">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <line x1="19" y1="12" x2="5" y2="12"></line>
    <polyline points="12 19 5 12 12 5"></polyline>
  </svg>
</a>

<div class="container">
  <h2>Book Appointment</h2>
  <div class="input-group"><label for="name">Patient Name</label><input id="name" type="text" placeholder="e.g., John Doe" /></div>
  
  <div class="input-group">
      <label for="mobile">Mobile Number</label>
      <input id="mobile" type="tel" name="phone" />
  </div>

  <div class="input-group"><label for="age">Age</label><input id="age" type="number" placeholder="e.g., 35" /></div>
  <div class="input-group"><label for="date">Appointment Date & Time</label><input id="date" type="datetime-local" /></div>
  
  <div class="button-group">
    <button class="soft-button add-btn" onclick="saveAppointment()">âž• Add Appointment</button>
    <button class="soft-button clear-btn" onclick="clearForm()">ðŸ§¹ Clear</button>
  </div>
</div>

<!-- intl-tel-input JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>

<script>
  // --- Initialize intl-tel-input ---
  const phoneInputField = document.querySelector("#mobile");
  // Initialize the plugin with the search option enabled
  const phoneInput = window.intlTelInput(phoneInputField, {
    initialCountry: "in", // Set default country to India
    showSearchInput: true, // <<< THIS IS THE KEY ADDITION
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js",
  });


  window.onload = () => {
    try {
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById("date").value = now.toISOString().slice(0, 16);
    } catch(e) {
      console.error("Could not set default date:", e);
    }
  };

  function saveAppointment() {
    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const date = document.getElementById("date").value;
    
    if (!phoneInput.isValidNumber()) {
        alert("Please enter a valid mobile number.");
        return;
    }
    
    const mobile = phoneInput.getNumber(); 

    if (!name || !age || !date) { 
      alert("Please fill all fields before booking."); 
      return; 
    }
    
    const loader = document.getElementById('loader');
    loader.classList.add('show');

    setTimeout(() => {
      try {
        const appointment = { name, mobile, age, date, status: 'Scheduled' };
        const appointments = JSON.parse(localStorage.getItem("appointments_db") || "[]");
        
        appointments.push(appointment);
        localStorage.setItem("appointments_db", JSON.stringify(appointments));
        
        alert("âœ… Appointment for " + name + " has been booked successfully!");
        window.location.href = "dashboard.html";
      } catch (error) {
        console.error("Error saving appointment:", error);
        alert("An error occurred while saving the appointment. Please try again.");
        loader.classList.remove('show');
      }
    }, 2000);
  }

  function clearForm() {
    document.getElementById("name").value = '';
    document.getElementById("age").value = '';
    phoneInput.setNumber("");
    window.onload();
  }
</script>

<div id="liveData">Loading live data...</div>

<script>
function fetchLiveData() {
    fetch("data.php")
        .then(response => response.json())
        .then(data => {
            document.getElementById("liveData").innerText =
                `Server time: ${data.time} - Message: ${data.message}`;
        })
        .catch(err => console.error("Error fetching live data:", err));
}
fetchLiveData();
setInterval(fetchLiveData, 5000);
</script>
<div id="liveData" style="padding:10px; background:#eef; border:1px solid #99f; margin-top:10px;">
Loading live data...
</div>

<script>
function fetchLiveData() {
    fetch("data.php")
        .then(response => response.json())
        .then(data => {
            document.getElementById("liveData").innerText =
                `Server time: ${data.time} | Message: ${data.message}`;
        })
        .catch(err => {
            document.getElementById("liveData").innerText = "Error loading live data.";
            console.error("Error fetching live data:", err);
        });
}
fetchLiveData();
setInterval(fetchLiveData, 5000);
</script>
<script>
function fetchRealTimeData() {
    fetch('data.php')
    .then(response => response.json())
    .then(data => {
        console.log('Real-time data:', data);
        // Update your page elements here, example:
        document.getElementById('realtime-time').innerText = data.time;
        document.getElementById('realtime-message').innerText = data.message;
    })
    .catch(console.error);
}

// Fetch every 3 seconds
setInterval(fetchRealTimeData, 3000);
window.onload = fetchRealTimeData;
</script>
</body>
</html>


